<!-- Search Bar -->
<div class="search-bar">
  <input
    [(ngModel)]="searchQuery"
    type="text"
    placeholder="Search vehicles..."
    class="search-input"
  />
  <button class="search-btn"><i class="fa-solid fa-magnifying-glass"></i> Search</button>
</div>

<!-- Fleet Table -->
<div class="fleet-table">
  <table>
    <thead class="table-dark">
      <tr>
        <th>Vehicle ID</th>
        <th>Type</th>
        <th>Make</th>
        <th>Model</th>
        <th>Year</th>
        <th>VIN</th>
        <th>Last Service</th>
        <th>Latest Mileage</th>
        <th>Status</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngIf="vehicles.length === 0">
        <td colspan="10" class="text-center text-muted py-3">
          <i class="fa-solid fa-circle-info me-2"></i> No data available at the moment
        </td>
      </tr>
      <tr *ngFor="let vehicle of vehicles | searchId : searchQuery">
        <td>{{ vehicle.vehicleId | uppercase }}</td>
        <td>{{ vehicle.type }}</td>
        <td>{{ vehicle.Make }}</td>
        <td>{{ vehicle.model }}</td>
        <td>{{ vehicle.year }}</td>
        <td>{{ vehicle.vin | uppercase }}</td>
        <td>{{ vehicle.lastService | date }}</td>
        <!-- this is for mileage if empty -->
        <td>
          <span *ngIf="getLatestMileage(vehicle.vehicleId) !== null; else noReading">
            {{ getLatestMileage(vehicle.vehicleId) | number }}
          </span>
          <ng-template #noReading>
            <span class="badge bg-warning text-dark">No Reading</span>
          </ng-template>
        </td>
        <td>
          <button
            class="btn btn-sm btn-outline-info"
            (click)="openMileageHistory(vehicle.vehicleId)"
          >
            View Mileage History
          </button>
        </td>
      </tr>
    </tbody>
  </table>
  <!-- Mileage History Modal -->
  <div class="modal fade mileage-history-modal" tabindex="-1" aria-hidden="true" #historyModal>
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">
            Mileage History for {{ selectedVehicle?.Make | uppercase }}
            {{ selectedVehicle?.model | uppercase }}
          </h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <table class="table table-striped">
            <thead>
              <tr>
                <!-- <th>Vehicle ID</th> -->
                <th>Reading ID</th>
                <th>Date</th>
                <th>Mileage (km)</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let reading of mileageHistory">
                <td>{{ reading.readingId }}</td>
                <td>{{ reading.timestamp | date : 'mediumDate' }}</td>
                <td>{{ reading.mileage }}</td>
              </tr>
            </tbody>
          </table>
          <div *ngIf="mileageHistory.length === 0" class="text-muted text-center">
            No mileage history available for this vehicle.
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
        </div>
      </div>
    </div>
  </div>
</div>
